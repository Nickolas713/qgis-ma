version: '3.8'

services:
  db:
    image: postgis/postgis:16-3.4
    restart: unless-stopped
    environment:
      - POSTGRES_USER=qgis
      - POSTGRES_PASSWORD=qgis
      - POSTGRES_DB=qgisdb
    volumes:
      - pg_data:/var/lib/postgresql/data
      # script que cria a tabela e insere dados
      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql:ro

  qgis:
    image: qgis/qgis-server:latest
    restart: unless-stopped
    depends_on:
      - db
    ports:
      - "7315:80"         # ← você pediu essa porta
    environment:
      # log mais silencioso
      - QGIS_SERVER_LOG_LEVEL=0
      # diz pro QGIS onde procurar projetos
      - QGIS_SERVER_LANDING_PAGE_PROJECTS_DIRECTORIES=/data
      # diz qual projeto carregar por padrão
      - QGIS_PROJECT_FILE=/data/project.qgs
      # opcional, ajuda em links internos
      - QGIS_SERVER_LANDING_PAGE_BASE_URL=http://localhost:7315
    volumes:
      # onde está o seu .qgs
      - ./data:/data:ro

volumes:
  pg_data:
